<div class="create-booking-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <button (click)="cancel()" class="back-button" aria-label="Go back">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            d="M19 12H5M12 19l-7-7 7-7"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </button>
      <div class="header-text">
        <h1>Create New Booking</h1>
        <p class="subtitle">Follow the steps below to create a new booking</p>
      </div>
    </div>
  </div>

  <!-- Progress indicator -->
  @if (isSubmitting) {
  <div class="progress-bar-container">
    <div class="progress-bar">
      <div class="progress-fill"></div>
    </div>
  </div>
  }

  <!-- Main Content -->
  <div class="main-content-wrapper">
    <!-- Stepper Container -->
    <div class="stepper-container">
      <!-- Custom Stepper -->
      <div class="custom-stepper">
        <div class="stepper-header">
          @for (step of steps; track step.index; let i = $index) {
          <div
            class="stepper-step"
            [class.active]="currentStepIndex === i"
            [class.completed]="currentStepIndex > i"
          >
            <div class="step-number">
              @if (currentStepIndex > i) {
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline
                  points="20 6 9 17 4 12"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              } @else {
              {{ i + 1 }}
              }
            </div>
            <div class="step-label">{{ step.label }}</div>
          </div>
          @if (i < steps.length - 1) {
          <div
            class="stepper-line"
            [class.completed]="currentStepIndex > i"
          ></div>
          } }
        </div>
      </div>

      <!-- Step Content -->
      <div class="step-content-wrapper">
        <!-- Step 1: Select Client -->
        @if (currentStepIndex === 0) {
        <div class="step-content">
          <app-select-client
            (clientSelected)="onClientSelected($event)"
          ></app-select-client>
        </div>
        }

        <!-- Step 2: Select Pets -->
        @if (currentStepIndex === 1) {
        <div class="step-content">
          <app-select-pets
            [selectedClient]="selectedClient"
            (petsSelected)="onPetsSelected($event)"
          ></app-select-pets>
        </div>
        }

        <!-- Step 3: Select Services -->
        @if (currentStepIndex === 2) {
        <div class="step-content">
          <app-select-service
            [selectedPets]="selectedPets"
            (servicesSelected)="onServicesSelected($event)"
          ></app-select-service>
        </div>
        }

        <!-- Step 4: Select Groomer -->
        @if (currentStepIndex === 3) {
        <div class="step-content">
          <app-select-groomer
            (groomerSelected)="onGroomerSelected($event)"
          ></app-select-groomer>
        </div>
        }

        <!-- Step 5: Select Date & Time -->
        @if (currentStepIndex === 4) {
        <div class="step-content">
          <app-select-date-time
            [selectedGroomer]="selectedGroomer"
            (dateTimeSelected)="onDateTimeSelected($event)"
          ></app-select-date-time>
        </div>
        }

        <!-- Step 6: Select Address -->
        @if (currentStepIndex === 5) {
        <div class="step-content">
          <app-select-address
            [selectedClient]="selectedClient"
            (addressSelected)="onAddressSelected($event)"
          ></app-select-address>
        </div>
        }

        <!-- Step 7: Payment & Review -->
        @if (currentStepIndex === 6) {
        <div class="step-content">
          <app-payment-summary
            [selectedClient]="selectedClient"
            [selectedPets]="selectedPets"
            [petServices]="petServices"
            [selectedGroomer]="selectedGroomer"
            [selectedDateTime]="selectedDateTime"
            [selectedAddress]="selectedAddress"
            (paymentConfigured)="onPaymentConfigured($event)"
          ></app-payment-summary>

          <!-- Error message -->
          @if (submitError) {
          <div class="error-message">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="10" />
              <line x1="12" y1="8" x2="12" y2="12" />
              <line x1="12" y1="16" x2="12.01" y2="16" />
            </svg>
            <span>{{ submitError }}</span>
          </div>
          }
        </div>
        }

        <!-- Step Actions -->
        <div class="step-actions">
          @if (currentStepIndex > 0) {
          <button class="btn btn-secondary" (click)="previousStep()">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M19 12H5M12 19l-7-7 7-7"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            Back
          </button>
          } @else {
          <div></div>
          }

          <div class="actions-right">
            @if (currentStepIndex < 6) {
            <button
              class="btn btn-primary"
              (click)="nextStep()"
              [disabled]="!canProceedToNextStep()"
            >
              Next
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M5 12h14M12 5l7 7-7 7"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            } @else {
            <button
              class="btn btn-primary btn-submit"
              (click)="submitBooking()"
              [disabled]="!isStep7Complete() || isSubmitting"
            >
              @if (isSubmitting) {
              <div class="spinner-small"></div>
              Creating... } @else {
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline
                  points="20 6 9 17 4 12"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              Create Booking }
            </button>
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
