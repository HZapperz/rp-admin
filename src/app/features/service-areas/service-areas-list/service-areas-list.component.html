<div class="service-areas">
  <div class="header-section">
    <h1 class="page-title">Service Areas & Territory Management</h1>
  </div>

  <!-- Success Message -->
  @if (successMessage) {
    <div class="alert alert-success">
      {{ successMessage }}
    </div>
  }

  <!-- Error Message -->
  @if (error) {
    <div class="alert alert-error">
      {{ error }}
    </div>
  }

  <!-- Info Banner -->
  <div class="info-banner">
    <div class="banner-icon">‚ÑπÔ∏è</div>
    <div class="banner-content">
      <h3>Van Territory Management - Coming Soon</h3>
      <p>
        This feature will enable automatic routing of bookings to specific vans based on territory assignments.
        See the component source code for detailed pseudocode and implementation plan.
      </p>
    </div>
  </div>

  @if (isLoading) {
    <div class="loading">Loading service areas...</div>
  }

  @if (!isLoading) {
    <!-- Current Zip Codes -->
    <div class="section-card">
      <div class="section-header">
        <div class="header-left">
          <h2>Serviceable Zip Codes</h2>
          <p class="section-description">
            Manage zip codes where grooming services are available.
          </p>
        </div>
        <button class="btn btn-primary" (click)="openAddModal()">
          + Add Zip Code
        </button>
      </div>

      <!-- Search Bar -->
      <div class="search-bar">
        <input
          type="text"
          class="search-input"
          placeholder="Search by zip code, city, or state..."
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
        />
      </div>

      <!-- Zip Codes Grid -->
      @if (filteredZipCodes.length === 0) {
        <div class="empty-state">
          <p>No zip codes found.</p>
          @if (searchTerm) {
            <button class="btn btn-secondary" (click)="searchTerm = ''; onSearchChange()">
              Clear Search
            </button>
          }
        </div>
      } @else {
        <div class="zip-code-grid">
          @for (zipCode of filteredZipCodes; track zipCode.id) {
            <div class="zip-code-card" [class.inactive]="!zipCode.is_active">
              <div class="zip-code-header">
                <span class="zip-code-number">{{ zipCode.zip_code }}</span>
                <span class="status-badge" [class.active]="zipCode.is_active" [class.inactive]="!zipCode.is_active">
                  {{ zipCode.is_active ? 'Active' : 'Inactive' }}
                </span>
              </div>
              <div class="zip-code-location">
                {{ zipCode.city }}, {{ zipCode.state }}
              </div>
              @if (zipCode.notes) {
                <div class="zip-code-notes">
                  <span class="notes-label">Notes:</span>
                  <span class="notes-text">{{ zipCode.notes }}</span>
                </div>
              }
              <!-- Future: Van assignment display -->
              <div class="zip-code-van">
                <span class="label">Assigned Van:</span>
                <span class="placeholder">Not yet assigned</span>
              </div>

              <!-- Action Buttons -->
              <div class="action-buttons">
                <button
                  class="btn-icon btn-toggle"
                  (click)="toggleStatus(zipCode)"
                  [title]="zipCode.is_active ? 'Deactivate' : 'Activate'"
                >
                  {{ zipCode.is_active ? '‚è∏' : '‚ñ∂' }}
                </button>
                <button
                  class="btn-icon btn-edit"
                  (click)="openEditModal(zipCode)"
                  title="Edit"
                >
                  ‚úèÔ∏è
                </button>
                <button
                  class="btn-icon btn-delete"
                  (click)="confirmDelete(zipCode)"
                  title="Delete"
                >
                  üóëÔ∏è
                </button>
              </div>
            </div>
          }
        </div>
      }
    </div>

    <!-- Future Van Management Section -->
    <div class="section-card placeholder-section">
      <h2>üöê Van Fleet Management</h2>
      <p class="section-description">
        Manage your grooming vans and their assigned territories.
      </p>

      <div class="placeholder-content">
        <div class="placeholder-icon">üöß</div>
        <h3>To Be Implemented</h3>
        <p>This section will include:</p>
        <ul>
          <li>View all active vans with status and capacity</li>
          <li>Assign zip codes to specific vans</li>
          <li>View van utilization metrics and booking density</li>
          <li>Automatic load balancing suggestions</li>
          <li>Territory rebalancing based on demand patterns</li>
        </ul>

        <div class="pseudocode-hint">
          <strong>üìù Implementation Details:</strong> See component TypeScript file for complete pseudocode and algorithm design
        </div>
      </div>
    </div>

    <!-- Future Territory Optimization -->
    <div class="section-card placeholder-section">
      <h2>üìä Territory Optimization</h2>
      <p class="section-description">
        AI-powered territory assignment recommendations based on booking patterns.
      </p>

      <div class="placeholder-content">
        <div class="placeholder-icon">ü§ñ</div>
        <h3>Smart Routing Algorithm</h3>
        <p>Features to be implemented:</p>
        <ul>
          <li>Booking density heatmaps by zip code</li>
          <li>Optimal van-to-territory assignments</li>
          <li>Travel time and distance optimization</li>
          <li>Peak hours and seasonal demand analysis</li>
          <li>Automatic overflow routing when vans reach capacity</li>
        </ul>
      </div>
    </div>
  }

  <!-- Zip Code Modal -->
  @if (showModal) {
    <app-zip-code-modal
      [zipCode]="selectedZipCode"
      (close)="closeModal()"
      (zipCodeSaved)="onZipCodeSaved()"
    ></app-zip-code-modal>
  }

  <!-- Delete Confirmation Dialog -->
  @if (zipCodeToDelete) {
    <div class="modal-overlay" (click)="cancelDelete()">
      <div class="confirmation-dialog" (click)="$event.stopPropagation()">
        <h3>Confirm Delete</h3>
        <p>
          Are you sure you want to delete zip code <strong>{{ zipCodeToDelete.zip_code }}</strong>
          ({{ zipCodeToDelete.city }}, {{ zipCodeToDelete.state }})?
        </p>
        <p class="warning-text">This action cannot be undone.</p>
        <div class="dialog-actions">
          <button class="btn btn-secondary" (click)="cancelDelete()">
            Cancel
          </button>
          <button class="btn btn-danger" (click)="deleteZipCode()">
            Delete
          </button>
        </div>
      </div>
    </div>
  }
</div>
